<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Leetcode 0936. Stamping The Sequence | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Leetcode 0936. Stamping The Sequence" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="https://leetcode.com/problems/stamping-the-sequence" />
<meta property="og:description" content="https://leetcode.com/problems/stamping-the-sequence" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-14T19:09:20+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Leetcode 0936. Stamping The Sequence" />
<script type="application/ld+json">
{"url":"/leetcode/0936.html","@type":"BlogPosting","headline":"Leetcode 0936. Stamping The Sequence","dateModified":"2021-08-14T19:09:20+02:00","datePublished":"2021-08-14T19:09:20+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"/leetcode/0936.html"},"author":{"@type":"Person","name":"Dmitry Babichev"},"description":"https://leetcode.com/problems/stamping-the-sequence","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  
  
</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/leetcode%20problems/">Leetcode problems</a><a class="page-link" href="/coding%20ideas/">Patterns</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/string"><code class="highligher-rouge"><nobr>string</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/greedy"><code class="highligher-rouge"><nobr>greedy</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/bit manipulation"><code class="highligher-rouge"><nobr>bit manipulation</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Leetcode 0936. Stamping The Sequence</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-08-14T19:09:20+02:00" itemprop="datePublished">
        Aug 14, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="https://leetcode.com/problems/stamping-the-sequence"> <font color="blue">https://leetcode.com/problems/stamping-the-sequence</font></a></p>

<h4 id="solution">Solution</h4>

<p>All algorithms I know for this problem follow the same pattern: let us start from the end and try to go in opposite direction. Imagine, that we have <code class="language-plaintext highlighter-rouge">target = aabcaca, stamp = abca</code>. Then we can go back and create <code class="language-plaintext highlighter-rouge">a????ca</code> string, then we can go to <code class="language-plaintext highlighter-rouge">a??????</code> and finally to <code class="language-plaintext highlighter-rouge">???????</code>. So, let us explain algorithm step by step:</p>

<ol>
  <li>Let <code class="language-plaintext highlighter-rouge">m</code> and <code class="language-plaintext highlighter-rouge">n</code> be length of <code class="language-plaintext highlighter-rouge">stamp</code> and <code class="language-plaintext highlighter-rouge">target</code>.</li>
  <li>Let <code class="language-plaintext highlighter-rouge">masks</code> be binary masks for every window, when we put <code class="language-plaintext highlighter-rouge">stamp</code> on <code class="language-plaintext highlighter-rouge">target</code>. There will be <code class="language-plaintext highlighter-rouge">n - m + 1</code> possible places for window. Window have <code class="language-plaintext highlighter-rouge">0</code> on place if stamp and target have the same element in given place. That is if bitmask equal to <code class="language-plaintext highlighter-rouge">0</code>, we have full occurrence of stamp inside target.</li>
  <li>Now, we create these <code class="language-plaintext highlighter-rouge">masks</code> and also create set <code class="language-plaintext highlighter-rouge">visited</code> of indexes (starts of windows) and queue with candidates.</li>
  <li>We always keep in our queue candidates, such that they fully coincide with part of target (if we have <code class="language-plaintext highlighter-rouge">?</code> symbol, it can be chosen as any symbol). We extract new candidate from left of our queue and add it to answer.</li>
  <li>Now, we want to understand, which elements we need to update, that is put <code class="language-plaintext highlighter-rouge">?</code> to them. We have <code class="language-plaintext highlighter-rouge">target_mask</code> variable for this.</li>
  <li>Let us iterate over each element we need to update (for example in <code class="language-plaintext highlighter-rouge">a????ca -&gt; a??????</code> we need to update last two elements) and when we mark element as <code class="language-plaintext highlighter-rouge">?</code>, we need to update all bits in <code class="language-plaintext highlighter-rouge">masks[j]</code>. Also we update <code class="language-plaintext highlighter-rouge">target_mask</code>.</li>
  <li>Let us found masks which are equal to <code class="language-plaintext highlighter-rouge">0</code> and add them to our queue if they are not visited yet.</li>
  <li>Finally, if <code class="language-plaintext highlighter-rouge">target_mask</code> is equal to zero, we return reversed answer and empty list in opposite case.</li>
</ol>

<h4 id="complexity">Complexity</h4>
<p>Time complexity for first step is <code class="language-plaintext highlighter-rouge">O((n-m)* n)</code>: first, we need to create masks, then for each of <code class="language-plaintext highlighter-rouge">n</code> elements, which we mark with <code class="language-plaintext highlighter-rouge">?</code>, we need to spend <code class="language-plaintext highlighter-rouge">O(m)</code> iterations to do it: they will change this number of windows. Also <code class="language-plaintext highlighter-rouge">to_update</code> can have potential size <code class="language-plaintext highlighter-rouge">m</code>, but we will put every of <code class="language-plaintext highlighter-rouge">n</code> elements to and out of queue only once. Finally, part, where we are looking for zero masks have also <code class="language-plaintext highlighter-rouge">O(m)</code> complexity and repeated no more than <code class="language-plaintext highlighter-rouge">m</code> times. Final time complexity is <code class="language-plaintext highlighter-rouge">O(n^2)</code>. Space complexity is <code class="language-plaintext highlighter-rouge">O(n(n-m))</code>.</p>

<h4 id="remark">Remark</h4>
<p>Note, that we use bitmask with big size (more than 32 or 64) here and python allow us to do it. Moreover, when we update masks, at the moment we use loops, if we replace it with direct update it potentially will be much faster, I will try to do it later.</p>

<h4 id="code">Code</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">movesToStamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stamp</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stamp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">target_mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">masks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">stamp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">masks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">visited</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">queue</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
                
        <span class="k">while</span> <span class="n">queue</span> <span class="ow">and</span> <span class="n">target_mask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cand</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">ans</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cand</span><span class="p">)</span>
            <span class="n">to_update</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cand</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cand</span> <span class="o">+</span> <span class="n">m</span><span class="p">))</span> <span class="k">if</span> <span class="n">target_mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">to_update</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">masks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">masks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">masks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)))</span>
                <span class="n">target_mask</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cand</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">cand</span> <span class="o">+</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">masks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                    <span class="n">visited</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">queue</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ans</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">target_mask</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
</code></pre></div></div>

<p>If you like the solution, you can <strong>upvote</strong> it on leetcode discussion section:<a href="https://leetcode.com/problems/stamping-the-sequence/discuss/1135633/python-o(n2)-solution-explained"> <font color="blue">Problem 0936</font></a></p>

  </div><a class="u-url" href="/leetcode/0936.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>